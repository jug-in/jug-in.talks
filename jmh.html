<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>JMH</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="node_modules/reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="node_modules/reveal.js/css/theme/black.css" id="theme"><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link href="node_modules/reveal.js/lib/css/zenburn.css" rel="stylesheet"><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "node_modules/reveal.js/css/print/pdf.css" : "node_modules/reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="node_modules/reveal.js/lib/js/html5shiv.js"></script><![endif]--><link rel="stylesheet" href="talks/theme/theme.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>JMH</h1><div class="preamble"><script type="text/javascript">
    window.addEventListener("load", function() {

        var ourSpan = document.createElement("span");
        var ourText = document.createTextNode("Java User Group Ingolstadt e.V.");
        ourSpan.appendChild(ourText);

        sectionTitle = document.querySelector("body div.reveal div.slides section.title");
        sectionTitle.insertBefore(ourSpan, sectionTitle.childNodes[0]);

        revealDiv = document.querySelector("body div.reveal");
        footer = document.getElementById("footer-left");
        revealDiv.appendChild(footer);

    } );

</script>
<div id="footer-left">
    <img id="footer-logo" src="talks/theme/jug-in_duke.png" />
</div>
<div class="paragraph"><p><em>Java Microbenchmark Harness</em></p></div></div></section>
<section id="_java_benchmarking"><h2>Java Benchmarking</h2><div class="ulist"><ul><li><p>JIT Optimization</p></li><li><p>Reproduction</p></li><li><p>Concurrency</p></li></ul></div></section>
<section><section id="_configuration"><h2>Configuration</h2><div class="paragraph"><p><em>at the example of maven (what else)</em></p></div></section><section id="_dependencies"><h2>Dependencies</h2><pre class="highlight listingblock code][source"><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
        &lt;artifactId&gt;jmh-core&lt;/artifactId&gt;
        &lt;version&gt;1.21&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt;
        &lt;artifactId&gt;jmh-generator-annprocess&lt;/artifactId&gt;
        &lt;version&gt;1.21&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre></section><section id="_build"><h2>Build</h2><pre class="highlight listingblock code][source"><code>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.2.1&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;&lt;goal&gt;shade&lt;/goal&gt;&lt;/goals&gt;
            &lt;configuration&gt;
                &lt;finalName&gt;benchmarks&lt;/finalName&gt;
                &lt;transformers&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt;
                        &lt;mainClass&gt;org.openjdk.jmh.Main&lt;/mainClass&gt;
                    &lt;/transformer&gt;
                &lt;/transformers&gt;
                &lt;filters&gt;&lt;filter&gt;
                    &lt;artifact&gt;*:*&lt;/artifact&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;
                        &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;
                        &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/filter&gt;&lt;/filters&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre></section><section id="_execution"><h2>Execution</h2><div class="paragraph"><p><code>java -jar target/benchmarks.jar</code></p></div></section></section>
<section><section id="_creating_tests"><h2>Creating Tests</h2></section><section id="_simplest_case"><h2>Simplest case</h2><pre class="highlight listingblock code][source"><code>import org.openjdk.jmh.annotations.Benchmark;

public class SomethingPerformanceCritical {
    @Benchmark
    public void testMePlenty() {
        // Doing heavy calculation stuff
    }
}</code></pre></section><section id="_configuration_overview"><h2>Configuration Overview</h2><pre class="highlight listingblock code][source"><code>@Benchmark
@BenchmarkMode({Mode.Throughput, Mode.SingleShotTime, Mode.SampleTime, Mode.AverageTime, Mode.All})
@Fork(warmups=5, value = 5)
@Measurement(iterations = 5, time = 5, timeUnit = TimeUnit.SECONDS)
@OperationsPerInvocation(1)
@OutputTimeUnit(TimeUnit.SECONDS)
@Threads(5)
@Timeout(time = 100, timeUnit = TimeUnit.MILLISECONDS)
@Warmup(iterations = 5, time = 5, timeUnit = TimeUnit.SECONDS)
public void configure() {}</code></pre></section><section id="_modes"><h2>Modes</h2><div class="paragraph"><p><code>@BenchmarkMode</code></p></div>
<div class="ulist"><ul><li><p>Throughput &#8594; Ops per second</p></li><li><p>Average Time &#8594; Avg duration</p></li><li><p>Sample Time &#8594; Duration statistics (min, max&#8230;&#8203;)</p></li><li><p>Single Shot Time &#8594; Time for single, cold execution</p></li><li><p>All</p></li></ul></div></section><section id="_state"><h2>State</h2><div class="paragraph"><p><code>@State</code> <em>(Thread, Group, Benchmark)</em>,
<code>@Setup</code>, <code>@TearDown</code></p></div>
<pre class="highlight listingblock code][source"><code>@State(Scope.Thread)
public static class MyState {
    public int a = 1;
    public int b = 2;
    public int sum ;
}

@Benchmark @BenchmarkMode(Mode.Throughput) @OutputTimeUnit(TimeUnit.MINUTES)
public void testMethod(MyState state) {
    state.sum = state.a + state.b;
}</code></pre></section></section>
<section id="_remarks"><h2>Remarks</h2><div class="ulist"><ul><li><p>Loop Optimizations</p></li><li><p>Dead Code Elimination</p></li></ul></div>
<pre class="highlight listingblock"><code>@Benchmark
public void testMethod(Blackhole blackhole) {
    // (...)
    blackhole.consume(computationResult);
}</code></pre></section>
<section><section id="_output"><h2>Output</h2></section><section id="_example"><h2>Example</h2><pre class="highlight listingblock code][source sh"><code># JMH version: 1.21
# VM version: JDK 12, OpenJDK 64-Bit Server VM, 12+33
# VM invoker: C:\Java\jdk12\bin\java.exe
# VM options: --enable-preview
# Warmup: 1 iterations, 5 s each
# Measurement: 2 iterations, 5 s each
# Timeout: 10 min per iteration
# Threads: 1 thread, will synchronize iterations
# Benchmark mode: Average time, time/op
# Benchmark: bayern.jugin.jmh.LoopingComparison.imperativeLoop

# Run progress: 0,00% complete, ETA 00:02:15
# Warmup Fork: 1 of 1
# Warmup Iteration   1: 2,941 ms/op
Iteration   1: 2,206 ms/op
Iteration   2: 2,273 ms/op

# Run progress: 11,11% complete, ETA 00:02:03
# Fork: 1 of 2
# Warmup Iteration   1: 3,094 ms/op
Iteration   1: 2,279 ms/op
Iteration   2: 2,388 ms/op

# Run progress: 22,22% complete, ETA 00:01:48
# Fork: 2 of 2
# Warmup Iteration   1: 2,651 ms/op
Iteration   1: 2,283 ms/op
Iteration   2: 2,335 ms/op


Result "bayern.jugin.jmh.LoopingComparison.imperativeLoop":
  2,321 |(99.9%) 0,331 ms/op [Average]
  (min, avg, max) = (2,279, 2,321, 2,388), stdev = 0,051
  CI (99.9%): [1,990, 2,653] (assumes normal distribution)


# JMH version: 1.21
# VM version: JDK 12, OpenJDK 64-Bit Server VM, 12+33
# VM invoker: C:\Java\jdk12\bin\java.exe
# VM options: --enable-preview
# Warmup: 1 iterations, 5 s each
# Measurement: 2 iterations, 5 s each
# Timeout: 10 min per iteration
# Threads: 1 thread, will synchronize iterations
# Benchmark mode: Average time, time/op
# Benchmark: bayern.jugin.jmh.LoopingComparison.iteratorLoop

# Run progress: 33,33% complete, ETA 00:01:32
# Warmup Fork: 1 of 1
# Warmup Iteration   1: 2,747 ms/op
Iteration   1: 2,216 ms/op
Iteration   2: 2,241 ms/op

# Run progress: 44,44% complete, ETA 00:01:17
# Fork: 1 of 2
# Warmup Iteration   1: 2,903 ms/op
Iteration   1: 2,238 ms/op
Iteration   2: 2,292 ms/op

# Run progress: 55,56% complete, ETA 00:01:01
# Fork: 2 of 2
# Warmup Iteration   1: 3,200 ms/op
Iteration   1: 2,476 ms/op
Iteration   2: 3,241 ms/op


Result "bayern.jugin.jmh.LoopingComparison.iteratorLoop":
  2,562 |(99.9%) 2,999 ms/op [Average]
  (min, avg, max) = (2,238, 2,562, 3,241), stdev = 0,464
  CI (99.9%): [? 0, 5,560] (assumes normal distribution)


# JMH version: 1.21
# VM version: JDK 12, OpenJDK 64-Bit Server VM, 12+33
# VM invoker: C:\Java\jdk12\bin\java.exe
# VM options: --enable-preview
# Warmup: 1 iterations, 5 s each
# Measurement: 2 iterations, 5 s each
# Timeout: 10 min per iteration
# Threads: 1 thread, will synchronize iterations
# Benchmark mode: Average time, time/op
# Benchmark: bayern.jugin.jmh.LoopingComparison.rangeLoop

# Run progress: 66,67% complete, ETA 00:00:46
# Warmup Fork: 1 of 1
# Warmup Iteration   1: 4,193 ms/op
Iteration   1: 2,997 ms/op
Iteration   2: 2,359 ms/op

# Run progress: 77,78% complete, ETA 00:00:30
# Fork: 1 of 2
# Warmup Iteration   1: 2,860 ms/op
Iteration   1: 2,241 ms/op
Iteration   2: 2,815 ms/op

# Run progress: 88,89% complete, ETA 00:00:15
# Fork: 2 of 2
# Warmup Iteration   1: 3,072 ms/op
Iteration   1: 2,355 ms/op
Iteration   2: 2,269 ms/op


Result "bayern.jugin.jmh.LoopingComparison.rangeLoop":
  2,420 |(99.9%) 1,730 ms/op [Average]
  (min, avg, max) = (2,241, 2,420, 2,815), stdev = 0,268
  CI (99.9%): [0,690, 4,150] (assumes normal distribution)


# Run complete. Total time: 00:02:19

REMEMBER: The numbers below are just data. To gain reusable insights, you need to follow up on
why the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial
experiments, perform baseline and negative tests that provide experimental control, make sure
the benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts.
Do not assume the numbers tell you what you want them to tell.

Benchmark                         Mode  Cnt  Score   Error  Units
LoopingComparison.imperativeLoop  avgt    4  2,321 | 0,331  ms/op
LoopingComparison.iteratorLoop    avgt    4  2,562 | 2,999  ms/op
LoopingComparison.rangeLoop       avgt    4  2,420 | 1,730  ms/op</code></pre></section></section></div></div><script src="node_modules/reveal.js/lib/js/head.min.js"></script><script src="node_modules/reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'h.v',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'node_modules/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      
      { src: 'node_modules/reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'node_modules/reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script></body></html>